<!-- EJERCICIO OBLIGATORIO MODULO 7 -->
<!doctype html>
<html>
<head><meta charset="utf-8"><title>CITAS</title> 
<link rel="stylesheet" type="text/css" href="citas_slide.css" />
<script type="text/javascript" src="javascript/jquery-2.1.4.min.js" ></script>
<script type="text/javascript" src="javascript/galeria.js" ></script>
<script type="text/javascript" src="zepto.min.js"></script>


<script>
var t, actual;
localStorage.galeriaBackup=(localStorage.galeriaBackup||JSON.stringify(galeria)); 
localStorage.galeriaLocal=(localStorage.galeriaLocal||0); 
galeria=JSON.parse(localStorage.galeriaLocal); 

function select(i){
   actual = i;

  $("nav a")
    .removeClass("on off")
    .addClass(function(j){return(j===i)?"on":"off";});

  $("#persona").html(galeria[i].persona);
  $("#frase").html(galeria[i].frase);
  $("#foto").attr("src", galeria[i].foto);

  clearTimeout(t);
  t = setTimeout( function(){select((i + 1) % galeria.length);}, 2000);
}


function generar_selector(){ // regenera la botonera
  var selector = $("#selector");

  selector.html("");
  
  galeria.forEach(function(elem,i) {
    selector.append("<li><a onClick='select("+i+")'></a></li>");
  });
}


$(function (){
  generar_selector();

  $("#editar").on("click", function(){
    clearTimeout(t);
    
    $("#persona_d").html(galeria[actual].persona);
    $("#frase_d").html(galeria[actual].frase);
    $("#foto_d").html(galeria[actual].foto);

    $("#datos").css("display", "block");
  })


  $("#nuevo").on("click", function(){
    $("#datos").css("display", "none");

    actual = galeria.push({
       persona:$("#persona_d").html(),
       frase:$("#frase_d").html(),
       foto:$("#foto_d").html()
    }) - 1;
    localStorage.galeriaLocal=JSON.stringify(galeria);
    generar_selector();
    select(actual);
 	
  })
<!-- SE AGREGA LA FUNCION DE BORRADO -->
  $("#borrar").on("click", function(){
		$("#datos").css("display", "none");
		
		galeria.splice(actual,1);
		actual=0;
        localStorage.galeriaLocal=JSON.stringify(galeria);
		generar_selector();
		select(actual);
  });

<!-- SE AGREGA LA FUNCION DE ACTUALIZAR -->
  $("#guardar").on("click", function(){
		$("#datos").css("display", "none");
		
		galeria.splice(actual,1,{
			persona:$("#persona_d").html(),
			frase:$("#frase_d").html(),
			foto:$("#foto_d").html()
		})
	    localStorage.galeriaLocal=JSON.stringify(galeria);
		actual = 0;
		generar_selector();
		
		select(actual);
   });

 $("#limpiar").on('click', function(){ 
 
 if (confirm('Â¿Seguro que deseas reiniciar las lista?')) { 
 // do things if OK
 galeria=JSON.parse(localStorage.galeriaBackup);
 localStorage.galeriaLocal=localStorage.galeriaBackup; }
 actual = 0;
 generar_selector();
 select(actual);
   });  
   
  select(0);
});



</script>
</head>
<body>
<div class="contenido">
  <nav> 
    <ul id="selector"></ul>
  </nav>
  <section id="caja">
    <img id="foto" alt="" />
    <div class="textos">
      <p id="frase"></p>
      <p id="persona"></p>
	</div>
	
    <div class="reinicio",aling align="left" >
	<button type="button" id="limpiar"> reiniciar lista </button>
   </div>
    
  </section>
  <div class="editar" id="editar"> 
    <img src="images/carat-d-white.svg" alt=""/>
  </div>
  <section id="datos">
    <div contentEditable="true" id="persona_d"></div>
    <div contentEditable="true" id="frase_d"></div>
    <div contentEditable="true" id="foto_d"></div>
<! SE ASOCIAN A LOS BOTONES LAS FUNCIONES AGREGADAS >
    <div id="botones">
     <ul>
        <li><img src="images/edit-black.svg" alt="" id="guardar"/></li>
        <li><img src="images/plus-black.svg" alt="" id="nuevo"/></li>
        <li><img src="images/delete-black.svg" alt="" id="borrar"/></li>
	 </ul>
    </div>
  </section>
  </div>
</body>
</html>